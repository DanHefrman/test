<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>2016-02-08-browserify-separate-app-and-vendor-bundles</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<!--


---
 "Browserify : separate app and vendor bundles"
excerpt: "Browserify : separate app and vendor bundles"
date: 2016-02-08 00:00:00 IST
updated: 2016-02-08 00:00:00 IST
categories: javascript
tags: browserify
---

-->
&lt;!DOCTYPE html&gt;
<html>
<head>
<title>
basic-git-workflow
</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="./css/bootstrap.css"> <link rel="stylesheet" href="./css/bootstrap.grid.css"> <link rel="stylesheet" href="./css/bootstrap.min.css"> <link rel="stylesheet" href="./css/bootstrap-reboot.min.css"> <link rel="stylesheet" href="./css/bootstrap.css.map"> <link rel="stylesheet" href="./css/blog-home.css"> <link rel="stylesheet" href="./css/prism.css">
<script async defer src="./css/prism.js"></script>
</head>
<body>
<p>When working with browserify, I like to separate bundles for libraries and vendor files and app. Since app bundle will change for most releases and vendor bundle will change only in couple of release and caches much longer. So for my application I have a <code>app.js</code> and <code>vendor.js</code>.</p>
<p>Since I have a react application, the libraries like <code>react</code>, <code>redux</code>, <code>react-redux</code> etc will got to <code>vendor.js</code> and and my components will go into <code>app.js</code>.</p>
<h2 id="splitting-bundles-in-command-line">Splitting bundles in command line</h2>
<p>We can use <code>--external</code> or <code>-x</code> option to tell browserify not to include <code>react</code>, <code>redux</code> and <code>react-redux</code> in <code>app.js</code> bundle.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">./node_modules/.bin/browserify</span> src/index.jsx -o dist/app.js -x=react -x=redux -x=react-redux -t [ babelify --presets [ es2015 react ] ]</a></code></pre></div>
<p>Now our app bundle is ready. Now it’s time for vendor bundle. For that we can use <code>--require</code> or <code>-r</code> option to require all our dependencies.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="ex">./node_modules/.bin/browserify</span> -o dist/vendor.js -r react -r redux -r react-redux</a></code></pre></div>
<h2 id="using-gulp">Using gulp</h2>
<p>In gulp, you can use <code>b.require()</code> method for requiring modules and <code>b.external()</code> method for specifying vendors. I added two different tasks, one to build the vendor and one for app. I add watch only for app build for performance.</p>
<p>Also I keep a array for vendor libraries to specify easily in each tasks.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="im">import</span> gulp <span class="im">from</span> <span class="st">&quot;gulp&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="im">import</span> browserify <span class="im">from</span> <span class="st">&quot;browserify&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="im">import</span> babelify <span class="im">from</span> <span class="st">&quot;babelify&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="im">import</span> source <span class="im">from</span> <span class="st">&quot;vinyl-source-stream&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="im">import</span> buffer <span class="im">from</span> <span class="st">&quot;vinyl-buffer&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="im">import</span> sourcemaps <span class="im">from</span> <span class="st">&quot;gulp-source-maps&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-7" title="7"></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="kw">const</span> vendors <span class="op">=</span> [<span class="st">&quot;react&quot;</span><span class="op">,</span> <span class="st">&quot;redux&quot;</span><span class="op">,</span> <span class="st">&quot;react-redux&quot;</span>]<span class="op">;</span></a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="va">gulp</span>.<span class="at">task</span>(<span class="st">&quot;build:vendor&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-11" title="11">  <span class="kw">const</span> b <span class="op">=</span> <span class="at">browserify</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-12" title="12">    <span class="dt">debug</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-13" title="13">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-14" title="14"></a>
<a class="sourceLine" id="cb3-15" title="15">  <span class="co">// require all libs specified in vendors array</span></a>
<a class="sourceLine" id="cb3-16" title="16">  <span class="va">vendors</span>.<span class="at">forEach</span>((lib) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-17" title="17">    <span class="va">b</span>.<span class="at">require</span>(lib)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-18" title="18">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-19" title="19"></a>
<a class="sourceLine" id="cb3-20" title="20">  <span class="va">b</span>.<span class="at">bundle</span>()</a>
<a class="sourceLine" id="cb3-21" title="21">    .<span class="at">pipe</span>(<span class="at">source</span>(<span class="st">&quot;vendor.js&quot;</span>))</a>
<a class="sourceLine" id="cb3-22" title="22">    .<span class="at">pipe</span>(<span class="at">buffer</span>())</a>
<a class="sourceLine" id="cb3-23" title="23">    .<span class="at">pipe</span>(<span class="va">sourcemaps</span>.<span class="at">init</span>(<span class="op">{</span> <span class="dt">loadMaps</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>))</a>
<a class="sourceLine" id="cb3-24" title="24">    .<span class="at">pipe</span>(<span class="va">sourcemaps</span>.<span class="at">write</span>(<span class="st">&quot;./maps&quot;</span>))</a>
<a class="sourceLine" id="cb3-25" title="25">    .<span class="at">pipe</span>(<span class="va">gulp</span>.<span class="at">dest</span>(<span class="st">&quot;./dist/&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-26" title="26"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-27" title="27"></a>
<a class="sourceLine" id="cb3-28" title="28"><span class="va">gulp</span>.<span class="at">task</span>(<span class="st">&quot;build:app&quot;</span><span class="op">,</span> () <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-29" title="29">  <span class="at">browserify</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-30" title="30">    <span class="dt">entries</span><span class="op">:</span> [<span class="st">&quot;./src/index.jsx&quot;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb3-31" title="31">    <span class="dt">extensions</span><span class="op">:</span> [<span class="st">&quot;.js&quot;</span><span class="op">,</span> <span class="st">&quot;.jsx&quot;</span>]<span class="op">,</span></a>
<a class="sourceLine" id="cb3-32" title="32">    <span class="dt">debug</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-33" title="33">  <span class="op">}</span>)</a>
<a class="sourceLine" id="cb3-34" title="34">    .<span class="at">external</span>(vendors) <span class="co">// Specify all vendors as external source</span></a>
<a class="sourceLine" id="cb3-35" title="35">    .<span class="at">transform</span>(babelify)</a>
<a class="sourceLine" id="cb3-36" title="36">    .<span class="at">bundle</span>()</a>
<a class="sourceLine" id="cb3-37" title="37">    .<span class="at">pipe</span>(<span class="at">source</span>(<span class="st">&quot;app.js&quot;</span>))</a>
<a class="sourceLine" id="cb3-38" title="38">    .<span class="at">pipe</span>(<span class="at">buffer</span>())</a>
<a class="sourceLine" id="cb3-39" title="39">    .<span class="at">pipe</span>(<span class="va">sourcemaps</span>.<span class="at">init</span>(<span class="op">{</span> <span class="dt">loadMaps</span><span class="op">:</span> <span class="kw">true</span> <span class="op">}</span>))</a>
<a class="sourceLine" id="cb3-40" title="40">    .<span class="at">pipe</span>(<span class="va">sourcemaps</span>.<span class="at">write</span>(<span class="st">&quot;./maps&quot;</span>))</a>
<a class="sourceLine" id="cb3-41" title="41">    .<span class="at">pipe</span>(<span class="va">gulp</span>.<span class="at">dest</span>(<span class="st">&quot;dist/&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-42" title="42"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-43" title="43"></a>
<a class="sourceLine" id="cb3-44" title="44"><span class="va">gulp</span>.<span class="at">task</span>(<span class="st">&quot;default&quot;</span><span class="op">,</span> [<span class="st">&quot;build:app&quot;</span><span class="op">,</span> <span class="st">&quot;build:vendor&quot;</span>])<span class="op">;</span></a></code></pre></div>
<p>That’s it. Now we have separate builds for app and vendor.</p>
</body>
</html>
