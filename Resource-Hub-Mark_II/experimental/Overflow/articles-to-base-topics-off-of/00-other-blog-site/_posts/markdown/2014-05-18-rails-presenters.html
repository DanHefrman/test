<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>2014-05-18-rails-presenters</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<!--


---
 "Rails : Presenters"
excerpt: "Getting started with rails presenters"
date: 2014-05-18 19:00:00 IST
updated: 2014-05-18 19:00:00 IST
categories: rails
---

-->
&lt;!DOCTYPE html&gt;
<html>
<head>
<title>
basic-git-workflow
</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="./css/bootstrap.css"> <link rel="stylesheet" href="./css/bootstrap.grid.css"> <link rel="stylesheet" href="./css/bootstrap.min.css"> <link rel="stylesheet" href="./css/bootstrap-reboot.min.css"> <link rel="stylesheet" href="./css/bootstrap.css.map"> <link rel="stylesheet" href="./css/blog-home.css"> <link rel="stylesheet" href="./css/prism.css">
<script async defer src="./css/prism.js"></script>
</head>
<body>
<p>Recently I noticed that my view templates are becoming more complicated as there are so many complex conditions in it. As per the design patterns the view should not contain any logic, So I needed some way to make my templates clean. Thats how I came to know about <strong>Presenters</strong>.</p>
<p>Presenters is a abstraction layer between the template and the controller. It encapsulates the complex conditions in the view template to the presenter class, which will make our view more clean, readable and testable.</p>
<p>Consider this as my view template before using presenters,</p>
<pre class="erb"><code>  &lt;!-- app/views/users/show.html.erb --&gt;
  &lt;dt&gt;Website:&lt;/dt&gt;
  &lt;dd&gt;
  &lt;% if @user.website.present? %&gt;
    &lt;%= link_to @user.website, @user.website %&gt;
  &lt;% else %&gt;
    &lt;span class=&quot;none&quot;&gt;None given&lt;/span&gt;
  &lt;% end %&gt;
  &lt;/dd&gt;
  &lt;dt&gt;Twitter:&lt;/dt&gt;
  &lt;dd&gt;
  &lt;% if @user.twitter_handle.present? %&gt;
    &lt;%= link_to @user.twitter_handle, &quot;http://twitter.com/#{@user.twitter_handle}&quot; %&gt;
  &lt;% else %&gt;
    &lt;span class=&quot;none&quot;&gt;None given&lt;/span&gt;
  &lt;% end %&gt;
  &lt;/dd&gt;</code></pre>
<p>This is a design smell. We are writing the conditionals in the template. How we can avoid this using presenters?</p>
<h1 id="using-presenters">Using Presenters</h1>
<p>Create a new folder named <code>presenters</code> in the <code>app</code> directory. Then create a <code>UserPresenter</code> class inside it.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># app/presenters/user_presenter.rb</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">class</span> <span class="dt">UserPresenter</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="kw">def</span> initialize</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw">end</span></a></code></pre></div>
<p>Now to use this, the easiest but <strong>ugly way</strong> is to let the controller know about the presenter.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># app/controllers/user_controller.rb</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">class</span> <span class="dt">UserController</span> &lt; <span class="dt">ApplicationController</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">def</span> show</a>
<a class="sourceLine" id="cb3-4" title="4">    user = <span class="dt">User</span>.find(params[<span class="st">:id</span>])</a>
<a class="sourceLine" id="cb3-5" title="5">    <span class="ot">@user</span> = <span class="dt">UserPresenter</span>.new(user, view_context)</a>
<a class="sourceLine" id="cb3-6" title="6">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="kw">end</span></a></code></pre></div>
<p>Passing the <code>view_context</code> to presenter help us to use the helper methods inside the presenter.</p>
<p>Now the updated <code>UserPresenter</code> will look like,</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb4-1" title="1"><span class="co"># app/presenters/user_presenter.rb</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">class</span> <span class="dt">UserPresenter</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="kw">def</span> initialize user, template</a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="ot">@user</span> = user</a>
<a class="sourceLine" id="cb4-5" title="5">    <span class="ot">@template</span> = template</a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb4-7" title="7"><span class="kw">end</span></a></code></pre></div>
<p>Now move the logic for the twitter and website into the presenter.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb5-1" title="1"><span class="co"># app/presenters/user_presenter.rb</span></a>
<a class="sourceLine" id="cb5-2" title="2"><span class="kw">class</span> <span class="dt">UserPresenter</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="kw">def</span> initialize user, template</a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="ot">@user</span> = user</a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="ot">@template</span> = template</a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb5-7" title="7"></a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="kw">def</span> website</a>
<a class="sourceLine" id="cb5-9" title="9">    <span class="kw">if</span> <span class="ot">@user</span>.website.present?</a>
<a class="sourceLine" id="cb5-10" title="10">      <span class="ot">@template</span>.link_to <span class="ot">@user</span>.website, <span class="ot">@user</span>.website</a>
<a class="sourceLine" id="cb5-11" title="11">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb5-12" title="12">      <span class="ot">@template</span>.content_tag <span class="st">:span</span>, <span class="st">&#39;None Given&#39;</span>, <span class="kw">class</span>:<span class="st">&#39;none&#39;</span></a>
<a class="sourceLine" id="cb5-13" title="13">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb5-14" title="14">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb5-15" title="15"></a>
<a class="sourceLine" id="cb5-16" title="16">  <span class="kw">def</span> twitter</a>
<a class="sourceLine" id="cb5-17" title="17">    <span class="kw">if</span> <span class="ot">@user</span>.twitter_handle.present?</a>
<a class="sourceLine" id="cb5-18" title="18">      <span class="ot">@template</span>.link_to <span class="ot">@user</span>.twitter_handle, <span class="st">&quot;http://twitter.com/</span><span class="ot">#{@user</span>.twitter_handle<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb5-19" title="19">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb5-20" title="20">      <span class="ot">@template</span>.content_tag <span class="st">:span</span>, <span class="st">&#39;None Given&#39;</span>, <span class="kw">class</span>:<span class="st">&#39;none&#39;</span></a>
<a class="sourceLine" id="cb5-21" title="21">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb5-22" title="22">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb5-23" title="23"><span class="kw">end</span></a></code></pre></div>
<p>So Now look into our view template</p>
<pre class="erb"><code>  &lt;!-- app/views/users/show.html.erb --&gt;
  &lt;dt&gt;Website:&lt;/dt&gt;
  &lt;dd&gt;&lt;% @user.website %&gt;&lt;/dd&gt;
  &lt;dt&gt;Twitter:&lt;/dt&gt;
  &lt;dd&gt;&lt;% @user.twitter %&gt;&lt;/dd&gt;</code></pre>
<p>Does it look much better than what we had before? I know, Yes!</p>
<p>But using <code>@template</code> to call all the helper method is not fine, so we need to refactor it by adding a method missing.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ruby"><code class="sourceCode ruby"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># app/presenters/user_presenter.rb</span></a>
<a class="sourceLine" id="cb7-2" title="2"><span class="kw">class</span> <span class="dt">UserPresenter</span></a>
<a class="sourceLine" id="cb7-3" title="3">  <span class="kw">def</span> initialize user, template</a>
<a class="sourceLine" id="cb7-4" title="4">    <span class="ot">@user</span> = user</a>
<a class="sourceLine" id="cb7-5" title="5">    <span class="ot">@template</span> = template</a>
<a class="sourceLine" id="cb7-6" title="6">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb7-7" title="7"></a>
<a class="sourceLine" id="cb7-8" title="8">  <span class="kw">def</span> website</a>
<a class="sourceLine" id="cb7-9" title="9">    <span class="kw">if</span> <span class="ot">@user</span>.website.present?</a>
<a class="sourceLine" id="cb7-10" title="10">      link_to <span class="ot">@user</span>.website, <span class="ot">@user</span>.website</a>
<a class="sourceLine" id="cb7-11" title="11">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb7-12" title="12">      content_tag <span class="st">:span</span>, <span class="st">&#39;None Given&#39;</span>, <span class="kw">class</span>:<span class="st">&#39;none&#39;</span></a>
<a class="sourceLine" id="cb7-13" title="13">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb7-14" title="14">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb7-15" title="15"></a>
<a class="sourceLine" id="cb7-16" title="16">  <span class="kw">def</span> twitter</a>
<a class="sourceLine" id="cb7-17" title="17">    <span class="kw">if</span> <span class="ot">@user</span>.twitter_handle.present?</a>
<a class="sourceLine" id="cb7-18" title="18">      link_to <span class="ot">@user</span>.twitter_handle, <span class="st">&quot;http://twitter.com/</span><span class="ot">#{@user</span>.twitter_handle<span class="ot">}</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb7-19" title="19">    <span class="kw">else</span></a>
<a class="sourceLine" id="cb7-20" title="20">      content_tag <span class="st">:span</span>, <span class="st">&#39;None Given&#39;</span>, <span class="kw">class</span>:<span class="st">&#39;none&#39;</span></a>
<a class="sourceLine" id="cb7-21" title="21">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb7-22" title="22">  <span class="kw">end</span></a>
<a class="sourceLine" id="cb7-23" title="23"></a>
<a class="sourceLine" id="cb7-24" title="24">  <span class="kw">private</span></a>
<a class="sourceLine" id="cb7-25" title="25">    <span class="kw">def</span> method_missing(*args, &amp;block)</a>
<a class="sourceLine" id="cb7-26" title="26">      <span class="ot">@template</span>.send(*args, &amp;block);</a>
<a class="sourceLine" id="cb7-27" title="27">    <span class="kw">end</span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="kw">end</span></a></code></pre></div>
<p>Even better Ah!!. Try out and lemme know how you felt about presenters.</p>
</body>
</html>
